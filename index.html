<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YuHuan | 服务状态监控</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --light-gray: #ecf0f1;
            --card-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.15);
            --card-shadow-hover: 0 16px 32px -8px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --radius-large: 16px;
            --radius-medium: 12px;
            --radius-small: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f5f7fb;
            padding: 0;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 25px 0;
            margin-bottom: 40px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }
        
        .logo-icon {
            font-size: 32px;
            color: var(--primary);
            margin-right: 15px;
        }
        
        .logo-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .logo-subtext {
            font-size: 15px;
            color: var(--gray);
            margin-top: 4px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .last-updated {
            font-size: 15px;
            color: var(--gray);
            margin-right: 25px;
        }
        
        .refresh-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-medium);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(67, 97, 238, 0.2);
        }
        
        .refresh-btn:hover {
            background-color: #3a56d4;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(67, 97, 238, 0.3);
        }
        
        .refresh-btn i {
            margin-right: 8px;
        }

        /* 统一总览卡片样式 */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            background: white;
            border-radius: var(--radius-large);
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .summary-card:nth-child(1) { animation-delay: 0.1s; }
        .summary-card:nth-child(2) { animation-delay: 0.2s; }
        .summary-card:nth-child(3) { animation-delay: 0.3s; }
        .summary-card:nth-child(4) { animation-delay: 0.4s; }
        .summary-card:nth-child(5) { animation-delay: 0.5s; }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow-hover);
        }
        
        .summary-value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
            color: var(--dark);
        }
        
        .summary-label {
            font-size: 14px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .summary-percentage {
            font-size: 16px;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .percentage-up { color: var(--success); }
        .percentage-warning { color: var(--warning); }
        .percentage-down { color: var(--danger); }
        
        .category-section {
            margin-bottom: 40px;
        }
        
        .category-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
        }
        
        .category-title i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .subcategory-section {
            margin-bottom: 30px;
        }
        
        .subcategory-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .subcategory-title i {
            margin-right: 8px;
            color: var(--info);
        }
        
        .monitors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .monitor-card {
            background: white;
            border-radius: var(--radius-large);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        
        .monitor-card:nth-child(1) { animation-delay: 0.1s; }
        .monitor-card:nth-child(2) { animation-delay: 0.2s; }
        .monitor-card:nth-child(3) { animation-delay: 0.3s; }
        .monitor-card:nth-child(4) { animation-delay: 0.4s; }
        .monitor-card:nth-child(5) { animation-delay: 0.5s; }
        .monitor-card:nth-child(6) { animation-delay: 0.6s; }
        .monitor-card:nth-child(7) { animation-delay: 0.7s; }
        .monitor-card:nth-child(8) { animation-delay: 0.8s; }
        
        .monitor-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--card-shadow-hover);
        }
        
        .monitor-status-bar {
            height: 6px;
            width: 100%;
        }
        
        .status-up {
            background: linear-gradient(90deg, var(--success), #27ae60);
        }
        
        .status-down {
            background: linear-gradient(90deg, var(--danger), #c0392b);
        }
        
        .status-warning {
            background: linear-gradient(90deg, var(--warning), #e67e22);
        }
        
        .status-paused {
            background: linear-gradient(90deg, var(--gray), #7f8c8d);
        }
        
        .monitor-content {
            padding: 25px;
        }
        
        .monitor-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .monitor-name {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            margin-right: 15px;
            display: flex;
            align-items: center;
        }
        
        .country-flag {
            width: 24px;
            height: 18px;
            margin-right: 10px;
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            object-fit: cover;
        }
        
        .clickable-name {
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .clickable-name:hover {
            color: var(--primary);
        }
        
        .status-pill {
            font-size: 14px;
            font-weight: 600;
            padding: 6px 14px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pill.up {
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }
        
        .status-pill.down {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }
        
        .status-pill.warning {
            background-color: rgba(243, 156, 18, 0.15);
            color: var(--warning);
        }
        
        .status-pill.paused {
            background-color: rgba(149, 165, 166, 0.15);
            color: var(--gray);
        }
        
        .monitor-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .uptime-container {
            margin-top: 20px;
        }
        
        .uptime-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .uptime-title {
            font-size: 14px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .uptime-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .uptime-bar {
            height: 10px;
            background: var(--light-gray);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .uptime-progress {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, var(--success), #27ae60);
            transition: width 0.5s ease;
        }
        
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(67, 97, 238, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 25px;
            font-size: 18px;
            color: var(--gray);
            text-align: center;
        }
        
        .error-container {
            background: white;
            border-radius: var(--radius-large);
            padding: 50px;
            text-align: center;
            box-shadow: var(--card-shadow);
        }
        
        .error-icon {
            font-size: 60px;
            color: var(--danger);
            margin-bottom: 25px;
        }
        
        .error-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        .error-message {
            font-size: 18px;
            color: var(--gray);
            margin-bottom: 25px;
        }
        
        .empty-container {
            background: white;
            border-radius: var(--radius-large);
            padding: 50px;
            text-align: center;
            box-shadow: var(--card-shadow);
        }
        
        .empty-icon {
            font-size: 60px;
            color: var(--gray);
            margin-bottom: 25px;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        @media (max-width: 992px) {
            .monitors-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-right {
                margin-top: 20px;
                width: 100%;
                justify-content: space-between;
            }
            
            .last-updated {
                margin-right: 0;
                font-size: 14px;
            }
            
            .monitor-name {
                font-size: 18px;
            }

            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 576px) {
            .monitors-grid {
                grid-template-columns: 1fr;
            }
            
            .monitor-stats {
                grid-template-columns: 1fr;
            }
            
            .error-container, .empty-container {
                padding: 30px 20px;
            }
            
            .error-title, .empty-title {
                font-size: 20px;
            }
            
            .error-message {
                font-size: 16px;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .summary-value {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <i class="fas fa-heartbeat logo-icon"></i>
                    <div>
                        <div class="logo-text">服务状态监控</div>
                        <div class="logo-subtext">本站由 YuHuan 开发</div>
                    </div>
                </a>
                <div class="header-right">
                    <div class="last-updated" id="last-updated"></div>
                    <button class="refresh-btn" onclick="fetchMonitors()">
                        <i class="fas fa-sync-alt"></i>
                        <span>刷新数据</span>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <main class="container">
        <!-- 统一的总览卡片区域 -->
        <div class="summary-cards" id="summary-cards"></div>
        
        <div id="data-center-container" class="category-section">
            <h2 class="category-title"><i class="fas fa-server"></i>数据中心</h2>
            <div id="china-mainland-container" class="subcategory-section">
                <h3 class="subcategory-title"><i class="fas fa-map-marker-alt"></i>中国大陆</h3>
                <div class="monitors-grid" id="china-mainland-monitors">
                    <div class="loading-container">
                        <div>
                            <div class="loading-spinner"></div>
                            <div class="loading-text">正在加载中国大陆监控数据...</div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="hmt-container" class="subcategory-section">
                <h3 class="subcategory-title"><i class="fas fa-map-marker-alt"></i>港澳台地区</h3>
                <div class="monitors-grid" id="hmt-monitors">
                    <div class="loading-container">
                        <div>
                            <div class="loading-spinner"></div>
                            <div class="loading-text">正在加载港澳台地区监控数据...</div>
                        </极客时间>
                    </div>
                </div>
            </div>
            <div id="overseas-container" class="subcategory-section">
                <h3 class="subcategory-title"><i class="fas fa-map-marker-alt"></i>境外</h3>
                <div class="monitors-grid" id="overseas-monitors">
                    <div class="loading-container">
                        <div>
                            <div class="loading-spinner"></div>
                            <div class="loading-text">正在加载境外监控数据...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="website-container" class="category-section">
            <h2 class="category-title"><i class="fas fa-globe"></i>网站</h2>
            <div class="monitors-grid" id="website-monitors">
                <div class="loading-container">
                    <div>
                        <div class="loading-spinner"></div>
                        <div class="loading-text">正在加载网站监控数据...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="loading-container" class="loading-container">
            <div>
                <div class="loading-spinner"></div>
                <div class="loading-text">正在加载监控数据...</div>
            </div>
        </div>
    </main>
    <footer style="text-align: center; padding: 20px; color: var(--gray);">
        &copy; 2025 YuHuan. All rights reserved. 基于 <a href="https://uptimerobot.com/" target="_blank">UptimeRobot API</a>
    </footer>
    <script>
        // 配置
        const config = {
            apiKey: 'ur3008252-3391970337016d08ad3db5de', // 替换为你的真实API Key
            autoRefresh: true,
            refreshInterval: 120000, // 2分钟
            showUptime: true
        };

        // 状态映射
        const statusMap = {
            0: { text: '已暂停', class: 'paused', icon: 'fa-pause' },
            1: { text: '未检查', class: 'paused', icon: 'fa-question' },
            2: { text: '正常运行', class: 'up', icon: 'fa-check-circle' },
            8: { text: '可能异常', class: 'warning', icon: 'fa-exclamation-triangle' },
            9: { text: '故障', class: 'down', icon: 'fa-times-circle' }
        };

        // 国家国旗映射
        const countryFlags = {
            'CN': 'https://flagcdn.com/w40/cn.png', // 中国
            'US': 'https://flagcdn.com/w40/us.png', // 美国
            'JP': 'https://flagcdn.com/w40/jp.png', // 日本
            'DE': 'https://flagcdn.com/w40/de.png', // 德国
            'SG': 'https://flagcdn.com/w40/sg.png', // 新加坡
            'HK': 'https://flagcdn.com/w40/hk.png', // 香港
            'TW': 'https://flagcdn.com/w40/tw.png', // 台湾
            'MO': 'https://flagcdn.com/w40/mo.png', // 澳门
            'GB': 'https://flagcdn.com/w40/gb.png', // 英国
            'FR': 'https://flagcdn.com/w40/fr.png', // 法国
            'CA': 'https://flagcdn.com/w40/ca.png', // 加拿大
            'AU': 'https://flagcdn.com/w40/au.png', // 澳大利亚
            'KR': 'https://flagcdn.com/w40/kr.png', // 韩国
            'IN': 'https://flagcdn.com/w40/in.png', // 印度
            'BR': 'https://flagcdn.com/w40/br.png', // 巴西
            'RU': 'https://flagcdn.com/w40/ru.png'  // 俄罗斯
        };

        // 国家名称映射
        const countryNames = {
            'CN': '中国',
            'US': '美国',
            'JP': '日本',
            'DE': '德国',
            'SG': '新加坡',
            'HK': '香港',
            'TW': '台湾',
            'MO': '澳门',
            'GB': '英国',
            'FR': '法国',
            'CA': '加拿大',
            'AU': '澳大利亚',
            'KR': '韩国',
            'IN': '印度',
            'BR': '巴西',
            'RU': '俄罗斯'
        };

        let refreshInterval;
        let nextUpdateTime = Date.now() + config.refreshInterval;

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            fetchMonitors();
            if (config.autoRefresh) {
                refreshInterval = setInterval(fetchMonitors, config.refreshInterval);
                startCountdown();
            }
        });

        // 开始倒计时
        function startCountdown() {
            setInterval(() => {
                const now = Date.now();
                const diff = nextUpdateTime - now;
                
                if (diff > 0) {
                    const minutes = Math.floor(d极客时间 / 60000);
                    const seconds = Math.floor((diff % 60000) / 1000);
                    document.querySelectorAll('.next-update').forEach(el => {
                        el.textContent = `下次更新: ${minutes}分${seconds}秒`;
                    });
                }
            }, 1000);
        }

        // 检查是否是IP地址
        function isIPAddress(url) {
            if (!url) return false;
            const ipPattern = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?::\d+)?$/;
            try {
                const domain = new URL(url.startsWith('http') ? url : `https://${url}`).hostname;
                return ipPattern.test(domain);
            } catch {
                return false;
            }
        }

        // 根据名称判断区域和国家
        function getLocationByName(name) {
            const lowerName = name.toLowerCase();
            
            // 港澳台地区关键词
            const hmtKeywords = ['香港', '澳门', '台湾', 'hong kong', 'macau', 'macao', 'taiwan', 'tw'];
            if (hmtKeywords.some(keyword => lowerName.includes(keyword.toLowerCase()))) {
                // 进一步判断具体地区
                if (lowerName.includes('香港') || lowerName.includes('hong kong')) {
                    return { location: 'hmt', country: 'HK' };
                } else if (lowerName.includes('澳门') || lowerName.includes('macau') || lowerName.includes('macao')) {
                    return { location: 'hmt', country: 'MO' };
                } else if (lowerName.includes('台湾') || lowerName.includes('taiwan')) {
                    return { location: 'hmt', country: 'TW' };
                }
                return { location: 'hmt', country: 'CN' };
            }
            
            // 中国大陆关键词
            const chinaKeywords = ['中国', 'china', 'cn', '大陆', '国内'];
            if (chinaKeywords.some(keyword => lowerName.includes(keyword.toLowerCase()))) {
                return { location: 'china-mainland', country: 'CN' };
            }
            
            // 其他国家关键词
            const countryKeywords = {
                '美国': 'US', 'usa': 'US', 'america': 'US',
                '日本': 'JP', 'japan': 'JP',
                '德国': 'DE', 'germany': 'DE',
                '新加坡': 'SG', 'singapore': 'SG',
                '英国': 'GB', 'uk': 'GB', 'united kingdom': 'GB',
                '法国': 'FR', 'france': 'FR',
                '加拿大': 'CA', 'canada': 'CA',
                '澳大利亚': 'AU', 'australia': 'AU',
                '韩国': 'KR', 'korea': 'KR',
                '印度': 'IN', 'india': 'IN',
                '巴西': 'BR', 'brazil': 'BR',
                '俄罗斯': 'RU', 'russia': 'RU'
            };
            
            for (const [keyword, code] of Object.entries(countryKeywords)) {
                if (lowerName.includes(keyword.toLowerCase())) {
                    return { location: 'overseas', country: code };
                }
            }
            
            // 默认视为境外
            return { location: 'overseas', country: 'US' };
        }

        // 获取监控数据
        function fetchMonitors() {
            document.getElementById('loading-container').style.display = 'flex';
            document.getElementById('summary-cards').innerHTML = '';
            
            // 为每个分类区域设置加载状态
            document.getElementById('china-mainland-monitors').innerHTML = `
                <div class="loading-container">
                    <div>
                        <div class="loading-spinner"></div>
                        <div class="loading-text">正在加载中国大陆监控数据...</div>
                    </div>
                </div>
            `;
            
            document.getElementById('hmt-monitors').innerHTML = `
                <div class="loading-container">
                    <div>
                        <div class="loading-spinner"></div>
                        <div class="loading-text">正在加载港澳台地区监控数据...</div>
                    </div>
                </div>
            `;
            
            document.getElementById('overseas-monitors').innerHTML = `
                <div class="loading-container">
                    <div>
                        <div class="loading-spinner"></div>
                        <div class="loading-text">正在加载境外监控数据...</div>
                    </div>
                </div>
            `;
            
            document.getElementById('website-monitors').innerHTML = `
                <div class="loading-container">
                    <div>
                        <div class="loading-spinner"></div>
                        <div class="loading-text">正在加载网站监控数据...</div>
                    </div>
                </div>
            `;
            
            nextUpdateTime = Date.now() + config.refreshInterval;
            
            const params = new URLSearchParams();
            params.append('api_key', config.apiKey);
            params.append('format', 'json');
            params.append('logs', '1');
            params.append('response_times', '1');
            params.append('all_time_uptime_ratio', '1');
            params.append('_', Date.now());

            fetch('https://api.uptimerobot.com/v2/getMonitors', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: params
            })
            .then(response => {
                if (response.status === 429) {
                    throw new Error('API请求过于频繁，请稍后再试');
                }
                if (!response.ok) {
                    throw new Error(`HTTP错误! 状态码: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.stat === 'ok') {
                    updateLastUpdated();
                    classifyAndDisplayMonitors(data.monitors);
                    
                    if (config.autoRefresh) {
                        clearInterval(refreshInterval);
                        refreshInterval = setInterval(fetchMonitors, config.refreshInterval);
                    }
                } else {
                    showError(data.error ? data.error.message : '未知API错误');
                }
            })
            .catch(error => {
                showError(error.message);
                console.error('错误:', error);
                
                if (error.message.includes('过于频繁')) {
                    const retryTime = 60000;
                    showError(`${error.message} - 将在1分钟后自动重试`);
                    setTimeout(fetchMonitors, retryTime);
                    
                    if (config.autoRefresh) {
                        clearInterval(refreshInterval);
                        config.refreshInterval = Math.min(config.refreshInterval * 2, 300000);
                        refreshInterval = setInterval(fetchMonitors, config.refreshInterval);
                    }
                }
            })
            .finally(() => {
                document.getElementById('loading-container').style.display = 'none';
            });
        }

        // 分类并显示监控项
        function classifyAndDisplayMonitors(monitors) {
            // 初始化统计数据
            const stats = {
                total: monitors.length,
                up: 0,
                warning: 0,
                down: 0,
                uptimeRatio: 0
            };
            
            const chinaMainlandMonitors = [];
            const hmtMonitors = [];
            const overseasMonitors = [];
            const websiteMonitors = [];
            
            monitors.forEach(monitor => {
                const status = statusMap[monitor.status] || statusMap[1];
                
                // 统计状态
                if (status.class === 'up') stats.up++;
                if (status.class === 'warning') stats.warning++;
                if (status.class === 'down') stats.down++;
                
                // 统计正常运行率
                stats.uptimeRatio += monitor.all_time_uptime_ratio ? 
                    parseFloat(monitor.all_time_uptime_ratio) : 0;
                
                const isIP = isIPAddress(monitor.url);
                
                if (isIP) {
                    const locationInfo = getLocationByName(monitor.friendly_name);
                    monitor.countryCode = locationInfo.country;
                    
                    if (locationInfo.location === 'china-mainland') {
                        chinaMainlandMonitors.push(monitor);
                    } else if (locationInfo.location === 'hmt') {
                        hmtMonitors.push(monitor);
                    } else {
                        overseasMonitors.push(monitor);
                    }
                } else {
                    websiteMonitors.push(monitor);
                }
            });
            
            // 计算平均正常运行率
            stats.uptimeRatio = monitors.length > 0 ? 
                (stats.uptimeRatio / monitors.length).toFixed(2) : 0;
            
            // 更新总览卡片
            updateSummaryCards(stats);
            
            // 显示各分类监控项
            displayMonitorList(chinaMainlandMonitors, 'china-mainland-monitors');
            displayMonitorList(hmtMonitors, 'hmt-monitors');
            displayMonitorList(overseasMonitors, 'overseas-monitors');
            displayMonitorList(websiteMonitors, 'website-monitors');
            
            // 如果没有某项，显示提示
            if (chinaMainlandMonitors.length === 0) {
                document.getElementById('china-mainland-monitors').innerHTML = '<p style="text-align:center;color:var(--gray);padding:20px;">暂无中国大陆数据中心监控</p>';
            }
            if (hmtMonitors.length === 0) {
                document.getElementById('hmt-monitors').innerHTML = '<p style="text-align:center;color:var(--gray);padding:20px;">暂无港澳台地区数据中心监控</p>';
            }
            if (overseasMonitors.length === 0) {
                document.getElementById('overseas-monitors').innerHTML = '<p style="text-align:center;color:var(--gray);padding:20px;">暂无境外数据中心监控</p>';
            }
            if (websiteMonitors.length === 0) {
                document.getElementById('website-monitors').innerHTML = '<p style="text-align:center;color:var(--gray);padding:20px;">暂无网站监控</p>';
            }
        }

        // 更新总览卡片 - 统一字体大小
        function updateSummaryCards(stats) {
            const container = document.getElementById('summary-cards');
            
            container.innerHTML = `
                <div class="summary-card">
                    <div class="summary-label">总监控数</div>
                    <div class="summary-value">${stats.total}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">正常运行</div>
                    <div class="summary-value">${stats.up}</div>
                    <div class="summary-percentage percentage-up">
                        ${stats.total > 0 ? (stats.up / stats.total * 100).toFixed(0) : 0}%
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">可能异常</div>
                    <div class="summary-value">${stats.warning}</div>
                    <div class="summary-percentage percentage-warning">
                        ${stats.total > 0 ? (stats.warning / stats.total * 100).toFixed(0) : 0}%
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">故障</div>
                    <div class="summary-value">${stats.down}</div>
                    <div class="summary-percentage percentage-down">
                        ${stats.total > 0 ? (stats.down / stats.total * 100).toFixed(0) : 0}%
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">平均正常运行率</div>
                    <div class="summary-value">${stats.uptimeRatio}%</div>
                </div>
            `;
        }

        // 显示监控列表
        function displayMonitorList(monitors, containerId) {
            const container = document.getElementById(containerId);
            if (!monitors || monitors.length === 0) return;
            
            let html = '';
            
            monitors.forEach((monitor, index) => {
                const status = statusMap[monitor.status] || statusMap[1];
                const uptime = monitor.all_time_uptime_ratio ? parseFloat(monitor.all_time_uptime_ratio) : 0;
                const lastLog = monitor.logs && monitor.logs.length > 0 ? monitor.logs[0] : null;
                const responseTime = monitor.response_times && monitor.response_times.length > 0 ? 
                    monitor.response_times[0].value : 'N/A';
                
                // 检查是否是IP地址
                const isIP = isIPAddress(monitor.url);
                const showUrl = !isIP;
                
                // 获取国家名称
                const countryName = countryNames[monitor.countryCode] || '';
                
                html += `
                    <div class="monitor-card" style="animation-delay: ${0.1 + index * 0.1}s">
                        <div class="monitor-status-bar status-${status.class}"></div>
                        <div class="monitor-content">
                            <div class="monitor-header">
                                <h3 class="monitor-name ${showUrl ? 'clickable-name' : ''}" 
                                    ${showUrl ? `onclick="window.open('${monitor.url}', '_blank')"` : ''}>
                                    ${isIP && monitor.countryCode ? 
                                        `<img src="${countryFlags[monitor.countryCode]}" alt="${countryName}" class="country-flag" title="${countryName}">` : ''}
                                    ${monitor.friendly_name}
                                </h3>
                                <div class="status-pill ${status.class}">${status.text}</div>
                            </div>
                            ${showUrl ? `<p class="monitor-url">${monitor.url.replace(/^https?:\/\//, '')}</p>` : ''}
                            
                            <div class="monitor-stats">
                                <div class="stat-item">
                                    <span class="stat-label">响应时间</span>
                                    <span class="stat-value">${responseTime} ms</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">最后检查</span>
                                    <span class="stat-value">${lastLog ? formatTime(lastLog.datetime * 1000) : 'N/A'}</span>
                                </div>
                            </div>
                            
                            <div class="uptime-container">
                                <div class="uptime-header">
                                    <span class="uptime-title">正常运行率</span>
                                    <span class="uptime-value">${uptime.toFixed(2)}%</span>
                                </div>
                                <div class="uptime-bar">
                                    <div class="uptime-progress" style="width: ${uptime}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // 显示错误
        function showError(message) {
            const container = document.getElementById('monitors-container');
            
            let specificAdvice = '';
            if (message.includes('过于频繁')) {
                specificAdvice = '<p style="margin-top:10px;">提示：已自动调整刷新频率，请稍后再试</p>';
            }
            
            container.innerHTML = `
                <div class="error-container">
                    <i class="fas fa-exclamation-circle error-icon"></i>
                    <h3 class="error-title">获取数据失败</h3>
                    <p class="error-message">${message}</p>
                    ${specificAdvice}
                    <button class="refresh-btn" onclick="fetchMonitors()" style="margin-top:15px;">
                        <i class="fas fa-sync-alt"></i>
                        <span>重试</span>
                    </button>
                </div>
            `;
        }

        // 更新最后更新时间
        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('last-updated').textContent = 
                `最后更新: ${formatTime(now)}`;
        }

        // 格式化时间
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            }).replace(/\//g, '-');
        }
    </script>
</body>
</html>